<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>API调试工具</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #debugOutput { 
            white-space: pre-wrap;
            background: #f5f5f5;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
    <h2>API调试工具</h2>
    <button onclick="runDebug()">运行API测试</button>
    <div id="debugOutput"></div>

<script>
// 调试专用函数
async function simpleLLM() {
	const apiUrl = 'https://api.deepseek.com/v1/chat/completions';
	const apiModel = 'deepseek-chat';
	const apiKey = 'sk-9fcbe013124c4652a7292f799abb1a03';

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({
                model: apiModel,
                messages: [{
                    role: "user",
                    content: "生成一个测试问题，包含答案和解析"
                }],
                temperature: 0.7
            })
        });

        // 完整打印响应对象
        console.log('完整响应:', response);
        
        if (!response.ok) {
            const errorBody = await response.text();
            throw new Error(`HTTP错误 ${response.status}: ${errorBody}`);
        }

        const data = await response.json();
        return data;
    } catch (error) {
        console.error('调试捕获到错误:', error);
        throw error; // 继续向上抛出以便处理
    }
}

// 调试触发器
async function runDebug() {
    const output = document.getElementById('debugOutput');
    output.innerHTML = '正在发送请求...';

    try {
        const startTime = Date.now();
        const result = await simpleLLM();
        const duration = Date.now() - startTime;

        // 控制台打印
        console.log('API耗时:', duration + 'ms');
        console.log('完整响应数据:', result);

        // 可视化显示
        output.innerHTML = `
            <div class="success">✅ 请求成功 (耗时 ${duration}ms)</div>
            <div>模型: ${result.model}</div>
            <div>ID: ${result.id}</div>
            <div>回复内容: 
                ${result.choices[0].message.content}
            </div>
            <details>
                <summary>完整响应数据</summary>
                <pre>${JSON.stringify(result, null, 2)}</pre>
            </details>
        `;
    } catch (error) {
        console.error('调试错误:', error);
        output.innerHTML = `
            <div class="error">⚠️ 请求失败: ${error.message}</div>
            ${error.stack ? `<pre>${error.stack}</pre>` : ''}
        `;
    }
}
</script>
</body>
</html>
