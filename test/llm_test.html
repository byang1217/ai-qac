<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>API调试工具</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #debugOutput { 
            white-space: pre-wrap;
            background: #f5f5f5;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
    <h2>API调试工具</h2>
    <button onclick="runDebug()">运行API测试</button>
    <div id="debugOutput"></div>

<script src="../utils.js?v=0.01"></script>
<script>
// 调试专用函数
async function simpleLLM() {
	const apiUrl = 'https://api.deepseek.com/v1/chat/completions';
	const apiModel = 'deepseek-chat';
	const apiKey = 'sk-9fcbe013124c4652a7292f799abb1a03';

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({
                model: apiModel,
                messages: [{
                    role: "user",
                    content: 
`
请为一个小学五年级的学生提供每日打卡的题目，内容是关于语文常识，古文，诗词和国学。
要求如下：
1. 生成2个选择题和1个填空题。
2. 选择题有4到6个备选答案，一个正确答案。
3. 填空题尽可能让答案是明确和唯一的，避免主观题导致不容易判断回答对错。
4. 每道题包括以下信息：
      a. 问题
      b. 答案
   c. 提示 
      d. 解题思路
5. 提示可以帮助用户解答题目，但是要避免直接透露答案本身。
6. 解题思路可以帮助用户理解答案，提高解决类似题目的能力。
7. 所有题目的信息用JSON格式返回。例如：
[
    {
        "id": 1,
        "type": "select",
        "question": "一星期有几天？",
        "options": ["1", "2", "7", "6"],
        "answer": "7",
        "hint": "查看下日历",
        "thinking": "这是一个关于日期的简单选择题，可以通过查看日历了解。"
    },
    {
        "id": 2,
        "type": "input",
        "question": "一年有几个月？（请用阿拉伯数字回答）",
        "answer": "12",
        "hint": "一年有365天，一个月大概有30天。",
        "thinking": "这是一个关于日期的简单选择题，可以通过查看日历了解。"
    }
]
8. 确保返回正确的json并且可以被Python json.loads方法解析.

请生成题目:
`
                }],
                temperature: 0.7
            })
        });

        // 完整打印响应对象
        console.log('完整响应:', response);
        
        if (!response.ok) {
            const errorBody = await response.text();
            throw new Error(`HTTP错误 ${response.status}: ${errorBody}`);
        }

        const data = await response.json();
        return data;
    } catch (error) {
        console.error('调试捕获到错误:', error);
        throw error; // 继续向上抛出以便处理
    }
}

// 调试触发器
async function runDebug() {
    const output = document.getElementById('debugOutput');
    output.innerHTML = '正在发送请求...';

    try {
        const startTime = Date.now();
        const result = await simpleLLM();
        const duration = Date.now() - startTime;

        const jsonData = extractAndParseJSON(result.choices[0].message.content)

        // 控制台打印
        console.log('API耗时:', duration + 'ms');
        console.log('完整响应数据:', result);
        console.log('jsonData:', jsonData);

        // 可视化显示
        output.innerHTML = `
            <div class="success">✅ 请求成功 (耗时 ${duration}ms)</div>
            <div>模型: ${result.model}</div>
            <div>ID: ${result.id}</div>
            <div>回复内容: 
                ${result.choices[0].message.content}
            </div>
            <div>jsonData: 
                ${jsonData}
            </div>
            <details>
                <summary>完整响应数据</summary>
                <pre>${JSON.stringify(result, null, 2)}</pre>
            </details>
        `;
    } catch (error) {
        console.error('调试错误:', error);
        output.innerHTML = `
            <div class="error">⚠️ 请求失败: ${error.message}</div>
            ${error.stack ? `<pre>${error.stack}</pre>` : ''}
        `;
    }
}
</script>
</body>
</html>
